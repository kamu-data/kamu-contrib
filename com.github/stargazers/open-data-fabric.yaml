---
kind: DatasetSnapshot
version: 1
content:
  name: com.github.stargazers.open-data-fabric.open-data-fabric
  kind: root
  metadata:
    - kind: setPollingSource
      fetch:
        kind: container
        image: "ghcr.io/kamu-data/fetch-com.github.stargazers:0.1.0"
        env:
          - name: GH_USER
            value: open-data-fabric
          - name: GH_REPO
            value: open-data-fabric
      read:
        kind: ndJson
        schema:
          - starred_at TIMESTAMP
          - login STRING
          - html_url STRING
          - url STRING
      # TODO: This no-op step makes kamu-cli use the experimental
      # DataFusion ingest implementation instead of Spark. This should be
      # removed once DataFusion ingest becomes the default.
      preprocess:
        kind: sql
        engine: datafusion
        query: select * from input
      merge:
        kind: ledger
        primaryKey:
          - starred_at
          - login
    - kind: setVocab
      eventTimeColumn: starred_at
