apiVersion: 1
kind: DatasetSnapshot
content:
  id: ca.vancouver.opendata.property.tax-report
  derivativeSource:
    inputs:
      - id: ca.vancouver.opendata.property.tax-report.2006
      - id: ca.vancouver.opendata.property.tax-report.2007
      - id: ca.vancouver.opendata.property.tax-report.2008
      - id: ca.vancouver.opendata.property.tax-report.2009
      - id: ca.vancouver.opendata.property.tax-report.2010
      - id: ca.vancouver.opendata.property.tax-report.2011
      - id: ca.vancouver.opendata.property.tax-report.2012
      - id: ca.vancouver.opendata.property.tax-report.2013
      - id: ca.vancouver.opendata.property.tax-report.2014
      - id: ca.vancouver.opendata.property.tax-report.2015
      - id: ca.vancouver.opendata.property.tax-report.2016
      - id: ca.vancouver.opendata.property.tax-report.2017
      - id: ca.vancouver.opendata.property.tax-report.2018
    steps:
      - kind: sparkSQL
        query: >
          SELECT
            system_time,
            2006 as TAX_ASSESSMENT_YEAR,
            PID,
            LEGAL_TYPE,
            FOLIO,
            LAND_COORDINATE,
            null as ZONE_NAME,
            null as ZONE_CATEGORY,
            LOT,
            BLOCK,
            PLAN,
            DISTRICT_LOT,
            FROM_CIVIC_NUMBER,
            TO_CIVIC_NUMBER,
            STREET_NAME,
            PROPERTY_POSTAL_CODE,
            NARRATIVE_LEGAL_LINE1,
            NARRATIVE_LEGAL_LINE2,
            NARRATIVE_LEGAL_LINE3,
            NARRATIVE_LEGAL_LINE4,
            NARRATIVE_LEGAL_LINE5,
            CURRENT_LAND_VALUE,
            CURRENT_IMPROVEMENT_VALUE,
            null as PREVIOUS_LAND_VALUE,
            null as PREVIOUS_IMPROVEMENT_VALUE,
            YEAR_BUILT,
            BIG_IMPROVEMENT_YEAR,
            TAX_LEVY,
            NEIGHBOURHOOD_CODE
          FROM `ca.vancouver.opendata.property.tax-report.2006`
          UNION ALL
          SELECT
            system_time,
            2007 as TAX_ASSESSMENT_YEAR,
            PID,
            LEGAL_TYPE,
            FOLIO,
            LAND_COORDINATE,
            null as ZONE_NAME,
            null as ZONE_CATEGORY,
            LOT,
            BLOCK,
            PLAN,
            DISTRICT_LOT,
            FROM_CIVIC_NUMBER,
            TO_CIVIC_NUMBER,
            STREET_NAME,
            PROPERTY_POSTAL_CODE,
            NARRATIVE_LEGAL_LINE1,
            NARRATIVE_LEGAL_LINE2,
            NARRATIVE_LEGAL_LINE3,
            NARRATIVE_LEGAL_LINE4,
            NARRATIVE_LEGAL_LINE5,
            CURRENT_LAND_VALUE,
            CURRENT_IMPROVEMENT_VALUE,
            null as PREVIOUS_LAND_VALUE,
            null as PREVIOUS_IMPROVEMENT_VALUE,
            YEAR_BUILT,
            BIG_IMPROVEMENT_YEAR,
            TAX_LEVY,
            NEIGHBOURHOOD_CODE
          FROM `ca.vancouver.opendata.property.tax-report.2007`
          UNION ALL
          SELECT
            system_time,
            2008 as TAX_ASSESSMENT_YEAR,
            PID,
            LEGAL_TYPE,
            FOLIO,
            LAND_COORDINATE,
            null as ZONE_NAME,
            null as ZONE_CATEGORY,
            LOT,
            BLOCK,
            PLAN,
            DISTRICT_LOT,
            FROM_CIVIC_NUMBER,
            TO_CIVIC_NUMBER,
            STREET_NAME,
            PROPERTY_POSTAL_CODE,
            NARRATIVE_LEGAL_LINE1,
            NARRATIVE_LEGAL_LINE2,
            NARRATIVE_LEGAL_LINE3,
            NARRATIVE_LEGAL_LINE4,
            NARRATIVE_LEGAL_LINE5,
            CURRENT_LAND_VALUE,
            CURRENT_IMPROVEMENT_VALUE,
            null as PREVIOUS_LAND_VALUE,
            null as PREVIOUS_IMPROVEMENT_VALUE,
            YEAR_BUILT,
            BIG_IMPROVEMENT_YEAR,
            TAX_LEVY,
            NEIGHBOURHOOD_CODE
          FROM `ca.vancouver.opendata.property.tax-report.2008`
          UNION ALL
          SELECT
            system_time,
            2009 as TAX_ASSESSMENT_YEAR,
            PID,
            LEGAL_TYPE,
            FOLIO,
            LAND_COORDINATE,
            null as ZONE_NAME,
            null as ZONE_CATEGORY,
            LOT,
            BLOCK,
            PLAN,
            DISTRICT_LOT,
            FROM_CIVIC_NUMBER,
            TO_CIVIC_NUMBER,
            STREET_NAME,
            PROPERTY_POSTAL_CODE,
            NARRATIVE_LEGAL_LINE1,
            NARRATIVE_LEGAL_LINE2,
            NARRATIVE_LEGAL_LINE3,
            NARRATIVE_LEGAL_LINE4,
            NARRATIVE_LEGAL_LINE5,
            CURRENT_LAND_VALUE,
            CURRENT_IMPROVEMENT_VALUE,
            null as PREVIOUS_LAND_VALUE,
            null as PREVIOUS_IMPROVEMENT_VALUE,
            YEAR_BUILT,
            BIG_IMPROVEMENT_YEAR,
            TAX_LEVY,
            NEIGHBOURHOOD_CODE
          FROM `ca.vancouver.opendata.property.tax-report.2009`
          UNION ALL
          SELECT
            system_time,
            2010 as TAX_ASSESSMENT_YEAR,
            PID,
            LEGAL_TYPE,
            FOLIO,
            LAND_COORDINATE,
            null as ZONE_NAME,
            null as ZONE_CATEGORY,
            LOT,
            BLOCK,
            PLAN,
            DISTRICT_LOT,
            FROM_CIVIC_NUMBER,
            TO_CIVIC_NUMBER,
            STREET_NAME,
            PROPERTY_POSTAL_CODE,
            NARRATIVE_LEGAL_LINE1,
            NARRATIVE_LEGAL_LINE2,
            NARRATIVE_LEGAL_LINE3,
            NARRATIVE_LEGAL_LINE4,
            NARRATIVE_LEGAL_LINE5,
            CURRENT_LAND_VALUE,
            CURRENT_IMPROVEMENT_VALUE,
            null as PREVIOUS_LAND_VALUE,
            null as PREVIOUS_IMPROVEMENT_VALUE,
            YEAR_BUILT,
            BIG_IMPROVEMENT_YEAR,
            TAX_LEVY,
            NEIGHBOURHOOD_CODE
          FROM `ca.vancouver.opendata.property.tax-report.2010`
          UNION ALL
          SELECT
            system_time,
            2011 as TAX_ASSESSMENT_YEAR,
            PID,
            LEGAL_TYPE,
            FOLIO,
            LAND_COORDINATE,
            null as ZONE_NAME,
            null as ZONE_CATEGORY,
            LOT,
            BLOCK,
            PLAN,
            DISTRICT_LOT,
            FROM_CIVIC_NUMBER,
            TO_CIVIC_NUMBER,
            STREET_NAME,
            PROPERTY_POSTAL_CODE,
            NARRATIVE_LEGAL_LINE1,
            NARRATIVE_LEGAL_LINE2,
            NARRATIVE_LEGAL_LINE3,
            NARRATIVE_LEGAL_LINE4,
            NARRATIVE_LEGAL_LINE5,
            CURRENT_LAND_VALUE,
            CURRENT_IMPROVEMENT_VALUE,
            null as PREVIOUS_LAND_VALUE,
            null as PREVIOUS_IMPROVEMENT_VALUE,
            YEAR_BUILT,
            BIG_IMPROVEMENT_YEAR,
            TAX_LEVY,
            NEIGHBOURHOOD_CODE
          FROM `ca.vancouver.opendata.property.tax-report.2011`
          UNION ALL
          SELECT
            system_time,
            2012 as TAX_ASSESSMENT_YEAR,
            PID,
            LEGAL_TYPE,
            FOLIO,
            LAND_COORDINATE,
            null as ZONE_NAME,
            null as ZONE_CATEGORY,
            LOT,
            BLOCK,
            PLAN,
            DISTRICT_LOT,
            FROM_CIVIC_NUMBER,
            TO_CIVIC_NUMBER,
            STREET_NAME,
            PROPERTY_POSTAL_CODE,
            NARRATIVE_LEGAL_LINE1,
            NARRATIVE_LEGAL_LINE2,
            NARRATIVE_LEGAL_LINE3,
            NARRATIVE_LEGAL_LINE4,
            NARRATIVE_LEGAL_LINE5,
            CURRENT_LAND_VALUE,
            CURRENT_IMPROVEMENT_VALUE,
            null as PREVIOUS_LAND_VALUE,
            null as PREVIOUS_IMPROVEMENT_VALUE,
            YEAR_BUILT,
            BIG_IMPROVEMENT_YEAR,
            TAX_LEVY,
            NEIGHBOURHOOD_CODE
          FROM `ca.vancouver.opendata.property.tax-report.2012`
          UNION ALL
          SELECT
            system_time,
            2013 as TAX_ASSESSMENT_YEAR,
            PID,
            LEGAL_TYPE,
            FOLIO,
            LAND_COORDINATE,
            null as ZONE_NAME,
            null as ZONE_CATEGORY,
            LOT,
            BLOCK,
            PLAN,
            DISTRICT_LOT,
            FROM_CIVIC_NUMBER,
            TO_CIVIC_NUMBER,
            STREET_NAME,
            PROPERTY_POSTAL_CODE,
            NARRATIVE_LEGAL_LINE1,
            NARRATIVE_LEGAL_LINE2,
            NARRATIVE_LEGAL_LINE3,
            NARRATIVE_LEGAL_LINE4,
            NARRATIVE_LEGAL_LINE5,
            CURRENT_LAND_VALUE,
            CURRENT_IMPROVEMENT_VALUE,
            null as PREVIOUS_LAND_VALUE,
            null as PREVIOUS_IMPROVEMENT_VALUE,
            YEAR_BUILT,
            BIG_IMPROVEMENT_YEAR,
            TAX_LEVY,
            NEIGHBOURHOOD_CODE
          FROM `ca.vancouver.opendata.property.tax-report.2013`
          UNION ALL
          SELECT
            system_time,
            2014 as TAX_ASSESSMENT_YEAR,
            PID,
            LEGAL_TYPE,
            FOLIO,
            LAND_COORDINATE,
            ZONE_NAME,
            ZONE_CATEGORY,
            LOT,
            BLOCK,
            PLAN,
            DISTRICT_LOT,
            FROM_CIVIC_NUMBER,
            TO_CIVIC_NUMBER,
            STREET_NAME,
            PROPERTY_POSTAL_CODE,
            NARRATIVE_LEGAL_LINE1,
            NARRATIVE_LEGAL_LINE2,
            NARRATIVE_LEGAL_LINE3,
            NARRATIVE_LEGAL_LINE4,
            NARRATIVE_LEGAL_LINE5,
            CURRENT_LAND_VALUE,
            CURRENT_IMPROVEMENT_VALUE,
            PREVIOUS_LAND_VALUE,
            PREVIOUS_IMPROVEMENT_VALUE,
            YEAR_BUILT,
            BIG_IMPROVEMENT_YEAR,
            TAX_LEVY,
            NEIGHBOURHOOD_CODE
          FROM `ca.vancouver.opendata.property.tax-report.2014`
          UNION ALL
          SELECT
            system_time,
            2015 as TAX_ASSESSMENT_YEAR,
            PID,
            LEGAL_TYPE,
            FOLIO,
            LAND_COORDINATE,
            ZONE_NAME,
            ZONE_CATEGORY,
            LOT,
            BLOCK,
            PLAN,
            DISTRICT_LOT,
            FROM_CIVIC_NUMBER,
            TO_CIVIC_NUMBER,
            STREET_NAME,
            PROPERTY_POSTAL_CODE,
            NARRATIVE_LEGAL_LINE1,
            NARRATIVE_LEGAL_LINE2,
            NARRATIVE_LEGAL_LINE3,
            NARRATIVE_LEGAL_LINE4,
            NARRATIVE_LEGAL_LINE5,
            CURRENT_LAND_VALUE,
            CURRENT_IMPROVEMENT_VALUE,
            PREVIOUS_LAND_VALUE,
            PREVIOUS_IMPROVEMENT_VALUE,
            YEAR_BUILT,
            BIG_IMPROVEMENT_YEAR,
            TAX_LEVY,
            NEIGHBOURHOOD_CODE
          FROM `ca.vancouver.opendata.property.tax-report.2015`
          UNION ALL
          SELECT
            system_time,
            2016 as TAX_ASSESSMENT_YEAR,
            PID,
            LEGAL_TYPE,
            FOLIO,
            LAND_COORDINATE,
            ZONE_NAME,
            ZONE_CATEGORY,
            LOT,
            BLOCK,
            PLAN,
            DISTRICT_LOT,
            FROM_CIVIC_NUMBER,
            TO_CIVIC_NUMBER,
            STREET_NAME,
            PROPERTY_POSTAL_CODE,
            NARRATIVE_LEGAL_LINE1,
            NARRATIVE_LEGAL_LINE2,
            NARRATIVE_LEGAL_LINE3,
            NARRATIVE_LEGAL_LINE4,
            NARRATIVE_LEGAL_LINE5,
            CURRENT_LAND_VALUE,
            CURRENT_IMPROVEMENT_VALUE,
            PREVIOUS_LAND_VALUE,
            PREVIOUS_IMPROVEMENT_VALUE,
            YEAR_BUILT,
            BIG_IMPROVEMENT_YEAR,
            TAX_LEVY,
            NEIGHBOURHOOD_CODE
          FROM `ca.vancouver.opendata.property.tax-report.2016`
          UNION ALL
          SELECT
            system_time,
            2017 as TAX_ASSESSMENT_YEAR,
            PID,
            LEGAL_TYPE,
            FOLIO,
            LAND_COORDINATE,
            ZONE_NAME,
            ZONE_CATEGORY,
            LOT,
            BLOCK,
            PLAN,
            DISTRICT_LOT,
            FROM_CIVIC_NUMBER,
            TO_CIVIC_NUMBER,
            STREET_NAME,
            PROPERTY_POSTAL_CODE,
            NARRATIVE_LEGAL_LINE1,
            NARRATIVE_LEGAL_LINE2,
            NARRATIVE_LEGAL_LINE3,
            NARRATIVE_LEGAL_LINE4,
            NARRATIVE_LEGAL_LINE5,
            CURRENT_LAND_VALUE,
            CURRENT_IMPROVEMENT_VALUE,
            PREVIOUS_LAND_VALUE,
            PREVIOUS_IMPROVEMENT_VALUE,
            YEAR_BUILT,
            BIG_IMPROVEMENT_YEAR,
            TAX_LEVY,
            NEIGHBOURHOOD_CODE
          FROM `ca.vancouver.opendata.property.tax-report.2017`
          UNION ALL
          SELECT
            system_time,
            2018 as TAX_ASSESSMENT_YEAR,
            PID,
            LEGAL_TYPE,
            FOLIO,
            LAND_COORDINATE,
            ZONE_NAME,
            ZONE_CATEGORY,
            LOT,
            BLOCK,
            PLAN,
            DISTRICT_LOT,
            FROM_CIVIC_NUMBER,
            TO_CIVIC_NUMBER,
            STREET_NAME,
            PROPERTY_POSTAL_CODE,
            NARRATIVE_LEGAL_LINE1,
            NARRATIVE_LEGAL_LINE2,
            NARRATIVE_LEGAL_LINE3,
            NARRATIVE_LEGAL_LINE4,
            NARRATIVE_LEGAL_LINE5,
            CURRENT_LAND_VALUE,
            CURRENT_IMPROVEMENT_VALUE,
            PREVIOUS_LAND_VALUE,
            PREVIOUS_IMPROVEMENT_VALUE,
            YEAR_BUILT,
            BIG_IMPROVEMENT_YEAR,
            TAX_LEVY,
            NEIGHBOURHOOD_CODE
          FROM `ca.vancouver.opendata.property.tax-report.2018`
